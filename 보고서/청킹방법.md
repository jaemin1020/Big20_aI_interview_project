## 기술 선정 보고서: 데이터 추출(Extraction) 방식의 채택

### 1. 개요

기존의 단순 텍스트 분할(Chunking) 방식은 면접관 AI가 지원자의 이력을 파편화된 정보로 인식하게 만드는 한계가 있습니다. 이를 극복하고 **고도화된 맞춤형 면접 서비스**를 제공하기 위해, LLM을 활용한 **구조화된 데이터 추출(Extraction to JSON)** 방식을 채택합니다.

2. 기술별 비교 분석

| **비교 항목**   | **Recursive Character (일반 청킹)** | **Semantic (의미론적 청킹)** | **Extraction (JSON 추출)**     |
| --------------------- | ----------------------------------------- | ---------------------------------- | ------------------------------------ |
| **데이터 형태** | 비정형 텍스트 뭉치                        | 의미 단위 문장 그룹                | **정형화된 필드 데이터**       |
| **맥락 유지**   | 낮음 (중간에 잘릴 위험)                   | 보통 (주제별 분리)                 | **최상 (전체 구조 파악 가능)** |
| **질문 정교도** | 일반적인 질문 위주                        | 문맥 기반 질문 가능                | **특정 역량 타기팅 질문 가능** |
| **검색 정확도** | 키워드 매칭 의존                          | 임베딩 유사도 의존                 | **데이터 필드 직접 참조**      |
| **구현 난이도** | 낮음                                      | 중간                               | 높음 (Prompt Engineering 필요)       |



### 3. JSON 구조 채택의 3가지 핵심 이유

#### **① 정보의 원자성(Atomicity) 확보**

* 단순 청킹은 "KISA 인턴"이라는 제목과 "보안 스크립트 설계"라는 성과가 서로 다른 청크로 나뉠 위험이 있습니다.
* JSON 방식을 사용하면 특정 경험(Experience) 노드 안에 기관명, 역할, 성과를 하나의 객체로 묶어 저장하므로 정보의 손실이 없습니다.

#### **② 다차원적 면접 로직 설계 가능**

* 사용자의 취약점(Weakness) 필드만 따로 추출하여 '압박 면접' 시나리오를 구성하거나, 기술 스택(Technical Skills) 필드를 참조해 '기술 심화 면접'을 구성하는 등 **동적인 면접 모드 전환**이 가능합니다.

#### **③ 토큰 효율성 및 프롬프트 제어**

* LLM에게 이력서 전체를 매번 읽히는 대신, 필요한 JSON 노드(예: 프로젝트 정보만)만 프롬프트에 주입함으로써 토큰 비용을 절감하고 AI가 답변의 범위를 벗어나지 않도록 강력하게 제어할 수 있습니다.


### 4. 기대 효과

본 방식의 도입을 통해 "BIGTERVIEW"는 단순한 챗봇 수준을 넘어, 지원자의 이력서 내 **핵심 역량(Snort, 위협 분석, 머신러닝 포부 등)** 간의 상관관계를 분석하고 꼬리 질문을 던지는 **지능형 면접 에이전트**로서의 경쟁력을 확보합니다.



## 1. JSON 기반 임베딩 전략: "필드별 벡터화"

JSON으로 구조화된 데이터를 어떻게 벡터 DB(Vector Database)에 넣고 활용할지에 대한 아키텍처입니다.

### ① 기술 및 정적 정보 (Metadata로 처리)

* **대상:** 학력, 자격증, 기술 스택 리스트 ^^
* **처리:** 이 항목들은 검색(Search)보다는 **필터링(Filtering)**에 가깝습니다. **임베딩보다는 메타데이터로 저장하여, 면접 AI가 "이 지원자는 정보보안기사 자격증이 있군"이라고 즉시 인지하게 합니다. **^^

### ② 경험 및 스토리 (임베딩 및 검색)

* **대상:** 프로젝트 상세, 경력 성과, 자기소개서 각 문항 ^^^^^^^^^^
* **처리:** 이 부분들을 각각의 **'청크(Chunk)'**로 간주하여 임베딩합니다.
  * **예:** "Snort 프로젝트" 내용 전체를 하나의 벡터로 생성 ^^
  * **예:** "성격의 단점과 보완책" 내용 전체를 하나의 벡터로 생성

왜 JSON 정리 후 임베딩이 더 좋은가? (비교)

| **구분**      | **일반 텍스트 임베딩** | **JSON 기반 전략적 임베딩**        |
| ------------------- | ---------------------------- | ---------------------------------------- |
| **검색 단위** | 글자 수 기반 (의미가 잘림)   | **의미 단위 (프로젝트/경험별)**    |
| **질문 생성** | 근처에 있는 문장을 긁어옴    | **연관된 필드 전체를 참조**        |
| **정확도**    | 질문과 무관한 내용이 섞임    | **해당 섹션의 정보만 정확히 추출** |



## 3. "BIGTERVIEW"를 위한 고도화 구현 로직

JSON 데이터를 바탕으로 면접관 AI가 질문을 던지는 내부 로직은 다음과 같이 설계하는 것이 가장 고도화된 방식입니다.

1. **Context 주입:** JSON의 `candidate_profile`과 `technical_skills`를 면접관 AI의 **System Prompt**에 고정값으로 넣어둡니다. (AI가 지원자를 기본적으로 '알고' 있게 함) ^^^^^^^^
2. **동적 검색(RAG):** 면접 진행 중 지원자가 특정 경험을 언급하면, 벡터 DB에서 해당 JSON 필드(예: `<span class="citation-214">projects</span>`)와 가장 유사한 원문을 찾아와서 **꼬리 질문**을 생성합니다. ^^
3. **데이터 무결성:** 요약되지 않은 원문을 임베딩했기 때문에, AI가 질문할 때 지원자가 사용한 단어(예: "무결점의 탐지율", "초격차 유지")를 그대로 사용하여 친밀감과 전문성을 동시에 높입니다. ^^^^^^^^


## 4. 보고서용 한 줄 정리

> **"본 시스템은 JSON으로 구조화된 데이터를 기반으로 '섹션별 독립 임베딩(Sectional Embedding)'을 수행함. 이를 통해 데이터 간 간섭을 최소화하고, 특정 프로젝트나 자기소개서 문항에 대해 누락 없는 고정밀 RAG(Retrieval-Augmented Generation)를 구현하여 면접 질문의 전문성을 극대화함.**



5. 청킹 잘안됬던 것 (주소 출력하지 말라고 했는데 자꾸 출력함)

모델의 크기(`qwen2.5:3b`)가 작을수록 프롬프트의 부정적인 지시어(예: "~하지 마세요")를 무시하고 원문 텍스트의 패턴을 그대로 따라가는 경향이 강합니다.

이 문제를 해결하기 위해  **1) Pydantic 필드 설명 강화** ,  **2) 프롬프트 내 제약 조건 가시화** , **3) 출력 예시(Few-shot) 추가** 세 가지 방법을 적용하여 프롬프트를 수정해 보시기 바랍니다.



### 1. Pydantic 모델 수정

`JsonOutputParser`는 Pydantic의 `description` 정보를 프롬프트에 포함시킵니다. 여기에 강력한 제약 사항을 명시하세요.

**Python**

```
class ResumeSchema(BaseModel):
    name: str = Field(description="이름")
    # 주소 제외를 description에 명시
    target_company: str = Field(description="지원 회사명 (주소, 지역, 상세 위치는 반드시 제외하고 순수 기업명만 기입)")
    target_position: str = Field(description="지원 직무명")
    # ... 나머지 필드 동일
```

---

### 2. 프롬프트 템플릿 수정

프롬프트 하단에만 적어두면 모델이 망각하기 쉽습니다. **"데이터 정제 규칙"** 섹션을 별도로 만들고, **잘못된 예시**를 보여주는 것이 효과적입니다.

**Python**

```
prompt = PromptTemplate(
    template="""당신은 이력서를 분석하여 구조화된 JSON 데이터로 변환하는 전문가입니다.

[데이터 정제 규칙 - 반드시 준수]
1. target_company: 주소(예: 서울시 강남구...), 상세 위치, 우편번호 등은 절대 포함하지 마세요. 오직 '회사명'만 추출합니다.
   - 예: "삼성전자 서초사옥" -> "삼성전자"
   - 예: "㈜아모레퍼시픽 본사 (서울 용산구...)" -> "아모레퍼시픽"
2. 모든 텍스트는 원문의 의미를 보존하되, 불필요한 공백이나 줄바꿈만 제거하세요.
3. self_introduction의 모든 항목은 문장의 끝까지 누락 없이 포함하세요.

이력서 원문:
{resume_text}

{format_instructions}

JSON:""",
    input_variables=["resume_text"],
    partial_variables={"format_instructions": parser.get_format_instructions()}
```



6.json으로 청킹할때도 실제 이력서 기반으로 잘 구분햇는지 확인하느라 시간많이 걸

최종적으로
