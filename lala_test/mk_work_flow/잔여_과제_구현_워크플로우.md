---
description: RAG 파이프라인 구축, 시스템 통합, AI 모델(STT/TTS/Vision/LLM) 설계 및 구현 등 남은 과제 수행을 위한 워크플로우
---

# 🚀 남은 과제 구현 워크플로우 (Remaining Tasks Implementation)

**📄 참고 문서 (Reference Documents)**
이 워크플로우는 아래 문서들을 기반으로 작성되었습니다:
- **[현황 분석]** `lala_test/work_flow/프로젝트_현황_보고서.md`
- **[일정 관리]** `lala_test/work_flow/A4_Project_WBS_업무관리_1.0.1.xlsx`
- **[요구사항]** `lala_test/work_flow/A4_Project_RFB_SRS_요구사항정의서.docx`
- **[시스템 설계]** `lala_test/work_flow/시스템 아키텍쳐 디자인(SAD)_1.0_수정중.docx`
- **[프로젝트 계획]** `lala_test/work_flow/웹 AI 모의면접 프로젝트 계획서.pdf`

---

이 워크플로우는 상기 문서들에 명시된 미구현/보완 필요 사항, 특히 **AI 모델 설계(STT/TTS/Vision/LLM)**와 **RAG 파이프라인**, **시스템 통합** 과제를 완수하기 위한 가이드입니다.

---

## 📅 Phase 1: AI 모델 설계 및 고도화 (Task 2.3.6 ~ 2.4.6) - **[설계 우선]**

**목표**: STT, TTS, Vision, LLM 각 모듈의 구체적인 모델 선정 및 동작 방식, 데이터 파이프라인을 상세 설계합니다.

### 1.1. STT (Speech-to-Text) 모델 설계 (`ai-worker/tasks/stt.py`)
- **기능 정의**: 사용자의 음성 답변을 텍스트로 변환하여 저장 및 분석에 활용.
- **설계 포인트**:
    - **실시간성 vs 정확도**: 면접 답변 특성상 실시간 스트리밍보다는 답변 완료 후 **배치 처리**가 적합한지 검토.
    - **모델 선정**: `OpenAI Whisper` (Local/API) vs `Deepgram` vs `Google STT`. (현재 비용/성능상 Whisper Large-v3 또는 Deepgram 권장)
- **작업 단위 (Task Unit)**:
    1. **STT 파이프라인 설계**: `frontend(MediaRecorder)` -> `backend(Upload)` -> `ai-worker(Processing)` 흐름 정의.
    2. **Noise Handling**: 배경 소음 제거(VAD) 전처리 로직 설계.
    3. **코드 구현**: `transcribe_audio(file_path)` 함수 작성.

### 1.2. TTS (Text-to-Speech) 모델 설계 (`ai-worker/tasks/tts.py`)
- **기능 정의**: AI 면접관의 질문을 자연스러운 음성으로 출력.
- **설계 포인트**:
    - **레이턴시 최적화**: 텍스트 생성 후 즉시 오디오 송출 필요 (Streaming TTS).
    - **모델 선정**: `ElevenLabs` (고품질/유료) vs `Edge-TTS` (무료/빠름) vs `OpenAI TTS`.
- **작업 단위 (Task Unit)**:
    1. **TTS 엔진 선정 및 프로토타이핑**: 각 API의 응답 속도 비교 테스트.
    2. **캐싱 전략**: 자주 묻는 질문(공통 질문)에 대한 오디오 파일 캐싱(Redis/S3) 설계.
    3. **코드 구현**: `generate_speech(text_stream)` 함수 작성.

### 1.3. Vision (영상/감정 분석) 모델 상세 설계 (`ai-worker/tasks/vision.py`)
- **기능 정의**: 면접자의 표정, 시선, 움직임을 분석하여 비언어적 태도 평가.
- **설계 포인트**:
    - **프레임 처리**: 전체 프레임 처리 시 부하 과다. → **초당 1~2프레임 샘플링** 전략 수립.
    - **모델 선정**: `DeepFace` (감정), `MediaPipe` (Face Mesh - 시선/고개), `OpenCV` (움직임).
- **작업 단위 (Task Unit)**:
    1. **분석 지표 정의**: '불안감(Eye Blink Rate)', '긍정적 표정 비율', '자세 유지' 등 구체적 메트릭 확정.
    2. **데이터 구조 설계**: 시간대별(Timeline) 분석 결과를 JSON으로 저장하는 스키마 설계 (`timestamp`, `emotion`, `gaze_vector`).
    3. **코드 구현/보완**: `analyze_video_segment(video_path)` 및 결과 집계 로직.

### 1.4. LLM 모델 설계 및 프롬프트 엔지니어링 (`ai-worker/tasks/llm.py`)
- **기능 정의**: 면접 질문 생성, 꼬리 질문(Follow-up), 답변 평가.
- **설계 포인트**:
    - **모델 선정**: 로컬 구동 `EXAONE 3.5` (Ollama) 사용 확정 (보안/비용 이점).
    - **Context Window**: 이력서 + 직무 기술서 + 이전 대화 내역 전체를 포함할 수 있는지 토큰 제한 검토.
- **작업 단위 (Task Unit)**:
    1. **System Prompt 구조화**: 페르소나(친절한/압박 면접관) 설정 및 출력 포맷(JSON 등) 강제.
    2. **Chain 설계**: 
        - 1단계: 이력서 분석/요약
        - 2단계: 질문 생성 (with RAG)
        - 3단계: 답변 평가 (채점 루브릭 기반)
    3. **코드 구현**: `local_llm_client` 클래스 및 `LangChain` 연동.

---

## 📅 Phase 2: RAG 파이프라인 구축 (Task 2.3.7)

**목표**: 외부 지식(PDF, 직무 기술서 등)을 Vector DB에 적재하고 이를 기반으로 질문 품질 향상.

### 2.1. 문서 로더 및 청킹 모듈 구현 (`ai-worker/tasks/rag_loader.py`)
- **작업 단위**:
    1. `PyPDFLoader`, `TextLoader` 활용 `load_document` 함수 구현.
    2. `RecursiveCharacterTextSplitter` 활용 `split_documents` 구현.

### 2.2. Vector DB 검색 로직 강화 (`ai-worker/db.py`)
- **작업 단위**:
    1. `pgvector` 활용 `embedding` 컬럼 추가 및 인덱싱.
    2. 코사인 유사도 기반 `search_similar_documents` 쿼리 구현.

### 2.3. Context 주입 질문 생성기 (`ai-worker/tasks/question_generator.py`)
- **작업 단위**:
    1. RAG 기반 프롬프트 템플릿 (`Context` + `Question`) 적용.
    2. `generate_question_with_rag` 함수 구현.

---

## 📅 Phase 3: 시스템 데이터 흐름 및 DB 연동 심화 (Task 2.4.5)

**목표**: Vision, STT, LLM 분석 결과가 DB에 누락 없이 저장되고 연결되는지 검증.

### 3.1. 멀티모달 데이터 저장 스키마 검증
- **작업 단위**:
    1. `InterviewResults` 테이블에 `stt_text`, `audio_url`, `emotion_json`, `evaluation_score` 등 필드 매핑 확인.
    2. 대용량 데이터(영상/음성)는 S3/MinIO 저장 후 URL만 DB 저장하는지 확인.

### 3.2. 전체 파이프라인 통합
- **작업 단위**:
    1. `backend-core`에서 비동기 작업(Celery) 트리거 및 상태 조회 API (`/status`) 구현.
    2. 완료 시 Frontend 알림(Polling/WebSocket) 처리.

---

## 📅 Phase 4: 시스템 통합 테스트 및 안정화 (Task 2.4.7)

**목표**: End-to-End 테스트 및 에러 핸들링.

### 4.1. 통합 테스트 시나리오
- **작업 단위**:
    1. **Full Flow**: 이력서 업로드 -> 면접 진행 -> 결과 페이지 확인.
    2. **Edge Case**: STT 인식 실패 시, 영상 업로드 실패 시 예외 처리 확인.

### 4.2. 로그 및 모니터링
- **작업 단위**:

---
**작성자**: 함유라
**작성일**: 2026-02-07
