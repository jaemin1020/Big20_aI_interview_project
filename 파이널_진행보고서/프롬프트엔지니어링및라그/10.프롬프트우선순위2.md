# 📌 실전 코드 기반 프롬프트 엔진 우선순위 재정립

## 📝 실제 사용된 프롬프트 템플릿 (PROMPT_TEMPLATE)

```text
PROMPT_TEMPLATE = """[|user|]당신은 전문적인 지식과 공정한 태도를 겸비한 베테랑 AI 면접관입니다.
다음 지침에 따라 지원자의 잠재력을 예리하게 파악할 수 있는 **단 하나의 질문**을 생성하십시오.

### [면접 전략 및 페르소나]
- 평가 대상 직무: {target_role}
- 핵심 인재상: {company_ideal}
- 면접 단계: {stage_name} ({guide})

### [참고 문맥: 지원자 정보 및 이전 답변]
{context}

### [실시간 핵심 임무]
- 수행 과업: {mode_task_instruction}
- 실행 상세: {mode_instruction}
- 전역 제약: {global_constraint}

### [출력 규칙 - 반드시 준수]
1. 인사말, 부연 설명, 자기소개, 가설 제시를 절대 하지 마십시오.
2. "질문입니다", "다음 질문은" 등 서두를 일절 붙이지 마십시오.
3. 오직 지원자에게 직접 던지는 **물음표(?)로 끝나는 단일 문장의 질문**만 출력하십시오.
4. 전문적인 한국어 구어체(하십시오체)를 사용하십시오.[|endofturn|]
[|assistant|]"""
```

---

실제 `PROMPT_TEMPLATE`의 물리적 배치와 LLM의 어텐션(Attention) 메커니즘을 결합한 최종 우선순위 분석입니다.

---

## 🔝 계층 0: [구조적 프레임] (초상위 프로토콜)

**전체 템플릿을 감싸는 역할 태그 (절대 우선순위: ★★★★★★)**

* **포함 내용**: `[|user|]`, `[|endofturn|]`, `[|assistant|]`
* **우선순위 이유**: AI 모델에게 "어디가 인간의 명령 영역인가"를 선언하는 **최상위 헌법**입니다. 이 태그가 모든 내용물(인재상, 규칙 등)을 `User`의 권위로 묶어줍니다.
* **역할**: 내부의 모든 우선순위가 작동할 수 있도록 공간을 만드는 **'OS(운영체제)급'** 지시어입니다.

## 🔝 계층 1: [출력 규칙 - 반드시 준수] (고정 텍스트 제약)

**템플릿 최하단 배치 (최우선순위: ★★★★★)**

* **포함 내용**: 인사말 금지, 물음표 단일 문장, 하십시오체 등
* **우선순위 이유**: AI가 답변을 생성하기 직전에 읽는 **마지막 명령**입니다. "반드시 준수"라는 표현과 강력한 부정 명령(하지 마십시오)이 결합되어, 위의 모든 맥락을 필터링하는 **최종 관문** 역할을 합니다.
* **실제 현상**: `{context}`에서 아무리 긴 답변이 와도, 여기서 "단일 문장"이라고 명령하면 AI는 앞의 내용을 무시하고 확 줄여버립니다.

## ➡ 계층 2: mode_instruction & global_constraint (출력 구조 제약)

**[실시간 핵심 임무] 블록 내부 (상위 우선순위: ★★★★☆)**

* **포함 내용**: "기술 스택 인용", "요약과 질문 결합" 등
* **우선순위 이유**: 질문의 **뼈대**를 정의합니다. `{guide}`(중단)에서 "상세히 물어봐"라고 했어도, 여기서 "80자 이내"나 "한 문장 결합"을 명령하면 AI는 뼈대를 맞추기 위해 내용을 깎아냅니다. **형식이 내용을 이기는 지점**입니다.

## ➡ 계층 3: mode_task_instruction & guide (내용 품질 지시)

**[면접 전략] 및 [임무] 상단 (중간 우선순위: ★★★☆☆)**

* **포함 내용**: "논리적 허점을 찔러라", "이전 답변 요약 후 질문하라" 등
* **우선순위 이유**: 질문의 **'영혼(의도)'**을 결정합니다. 어떤 소재를 가지고 어떤 의도로 질문할지 결정하지만, 계층 1·2의 형식 제약을 위반하지 않는 선에서만 작동합니다.

## ➡ 계층 4: context (맥락 정보)

**중간 [참고 문맥] 블록 (재료 우선순위: ★★☆☆☆)**

* **포함 내용**: 지원자의 자기소개서, 이전 대화 내역 등
* **우선순위 이유**: 질문을 만들기 위한 **'요리 재료'**입니다. 가장 양이 많지만 지시 사항이 아닌 '참조 데이터'이므로, AI는 지시어(1~3계층)를 따르기 위해 이 데이터를 가공하거나 생략합니다.

## ➡ 계층 5: target_role & company_ideal & stage_name (배경 정보)

**최상단 [면접 전략 및 페르소나] (기초 우선순위: ★☆☆☆☆)**

* **포함 내용**: "백엔드 개발", "창의와 혁신 인재상" 등
* **우선순위 이유**: 전체적인 **'톤 앤 매너'**를 잡는 배경 음악입니다. 가장 먼저 입력되므로 뒤에 오는 구체적인 지시어(실시간 임무 등)들에 의해 덮어씌어질 확률이 가장 높습니다.

---

### 🧪 결론: 왜 우선순위가 바뀌지 않는가?

사용자님의 템플릿은 **역피라미드 구조**를 띠고 있습니다.

1. **Bottom-Up Override**: 가장 아래에 있는 `[출력 규칙]`이 전체를 지배합니다.
2. **Specific over General**: 구체적인 `{global_constraint}`가 일반적인 페르소나보다 강합니다.
3. **Instruction over Data**: 지시어 블록이 `{context}`보다 위에 있거나 더 아래에 명확히 명시되어 데이터를 통제합니다.

따라서 처음에 분석했던 **[강한 형식 제약 → 출력 구조 → 내용 품질 지시 → 맥락 정보]** 체계는 이 코드 템플릿에서 완벽하게 작동하고 있습니다.

---

# 🧠 핵심 원리: 위치(Position) vs 내용(Content)

프롬프트의 우선순위는 단순히 내용이 중요하다고 해서 결정되지 않습니다. **물리적 배치**와 **논리적 강도**의 조합입니다.

### 1. 위치의 힘 (Recency Bias)

* **위치**: 하단(Bottom) > 상단(Top) >> 중간(Middle)
* LLM은 출력 직전의 텍스트에 가장 높은 어텐션(Attention)을 할당합니다. 현재 템플릿에서 **[출력 규칙]**이 하단에 배치된 것은 AI의 행동을 통제하는 가장 강력한 **'물리적 족쇄'** 역할을 합니다.

### 2. 내용의 힘 (Constraint Strength)

* **표현**: 부정/절대 명령(Must not) > 긍정 지시(Do) > 참고 정보(Context)
* "절대 하지 마십시오"와 같은 강력한 부정 제약은 AI의 확률 계산에서 해당 토큰이 나올 가능성을 강제로 0에 가깝게 누릅니다.

### 🎯 설계 요약: "Golden Shield"

사용자님의 `PROMPT_TEMPLATE`가 강력한 이유는, **가장 강한 내용(절대 명령)**을 **가장 강력한 위치(최하단)**에 배치했기 때문입니다. 이 구조를 바꾸면(예: 출력 규칙을 위로 올림), AI가 지시사항을 어길 확률이 비약적으로 상승하게 됩니다.
