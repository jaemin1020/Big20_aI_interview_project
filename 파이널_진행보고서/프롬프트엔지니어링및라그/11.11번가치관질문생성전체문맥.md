# 11번 가치관(책임감) 질문 생성: 전체 문맥 활용 전략 분석

## 1. 개요 (Overview)
본 보고서는 AI 면접관의 11번 질문(책임감 및 가치관 평가) 단계에서, 왜 일반적인 요약 방식이 아닌 **자기소개서 답변 전문(Full Context)**을 그대로 가져와 활용하는지 그 설계 의도와 구현 코드를 상세히 분석합니다.

---

## 2. 전체 문맥(Full Context) 활용 이유

11번 질문은 지원자의 인생 철학, 직업 윤리, 그리고 새로운 환경(IT)에 임하는 마음가짐을 파악하는 핵심 단계입니다. 이 단계에서 '전체 문맥'을 유지하는 이유는 다음과 같습니다.

1.  **핵심 가치 보존**: 한두 줄로 요약할 경우, "단순한 기능 구현보다 지탱하는 구조(Architecture)에 매력을 느낀다"와 같은 지원자만의 독특한 가치 표현이 누락될 위험이 큽니다.
2.  **정밀 인용 유도**: 11번 가이드라인은 **"자기소개서의 문장을 그대로 인용하라"**는 높은 수준의 임무를 부여합니다. 이를 수행하기 위해서는 AI(EXAONE)에게 충분한 원본 텍스트가 제공되어야 합니다.
3.  **다차원 분석**: 답변 전문을 제공함으로써 AI가 지원 동기뿐만 아니라 그 이면에 깔린 성실함과 전문성을 동시에 읽어내도록 유도합니다.

---

## 3. 코드 분석: 답변 전문 추출 (Python Implementation)

`question_generator.py` (Line 319~354) 섹션에서 이뤄지는 전문 추출 로직입니다.

### [경로 A] 구조화된 데이터에서 답변 전문 추출
DB의 `structured_data` 필드 내에서 특정 질문(질문1)을 찾아 그 답변(`ans`)을 **글자 수 제한 없이** 변수에 바로 할당합니다.

```python
# for loop를 통한 리스트 순회
for item in self_intro_list:
    q_text = item.get("question", "")  # 질문 텍스트 추출
    
    # 🔍 조건문: 질문 1인지 식별
    if "[질문1]" in q_text or "질문 1" in q_text or q_text.startswith("1."):
        
        # ✅ 전문 추출: .get('answer')로 답변 전체를 ans 변수에 담음 (제한 없음)
        ans = item.get('answer', '') 
        
        if len(ans) > 20: 
            # 🚀 f-string: 전문({ans})을 문맥(Context)에 그대로 삽입
            values_text = f"[지원자 자기소개서 질문1 답변]: {ans}"
            break  # 매칭 성공 시 즉시 종료
```

### [경로 B] 벡터 DB 검색(RAG)를 통한 보강
구조화된 데이터 외에도 가치관과 관련된 키워드로 벡터 검색을 병행하여 문맥의 풍부함을 더합니다.

```python
# RAG 수행 (Vector DB 검색)
rag_results = retrieve_context("지원자의 근본적인 가치관, 생활 신념...", top_k=2)
# 추출된 조각(Chunk)들을 개행문자로 결합
rag_context = "\n".join([r['text'] for r in rag_results])
```

---

## 4. 데이터 구성 및 제약 사항 분석

### 이중 데이터 결합 (Dual-Path)
AI 워커는 다음과 같이 두 경로의 정보를 하나로 합쳐서 LLM에게 던집니다.

```python
# 최종 조립
context_text = f"{values_text}\n\n[추가 참고 정보]:\n{rag_context}".strip()
```

### 글자 수 및 절단 현상 원인
일부 로그에서 `[추가 참고 정보]` 부분이 잘려 보이는 현상은 다음과 같은 이유 때문입니다.

1.  **Vector DB Chunk Size**: 벡터 DB에 저장된 데이터는 검색 효율을 위해 일정 글자 수(예: 500~1000자)로 미리 잘려(Chunking) 저장되어 있습니다. 따라서 RAG로 가져온 정보는 물리적으로 잘린 형태일 수 있습니다.
2.  **우선순위 역전 방지**: `values_text`는 전문을 가져오되, `rag_context`는 보조 자료이므로 검색 엔진이 제공한 분량만큼만 사용합니다.

---

## 5. 결론
11번 질문 로직은 **'정밀 데이터 추출(Structured Data)'**과 **'유연한 검색(RAG)'**을 결합한 하이브리드 방식을 채택하고 있습니다. 답변 전문을 보존하는 파이썬의 `item.get('answer')` 방식은 AI가 지원자의 핵심 가치관을 왜곡 없이 파악하고 인용하게 만드는 가장 강력한 장치입니다.

---

## 6. 11번 스테이지 질문 생성 가이드 및 상세 지시어

11번 질문 생성 시 AI에게 하달되는 고정 가이드와 실시간 동적 지시어는 다음과 같이 설계되어 있습니다.

### [가이드 1] 시나리오 고정 가이드 (`interview_scenario_transition.py`)
이 가이드는 AI가 질문을 구성하는 기본적인 형식을 결정합니다.

> "제공된 [지원자 자기소개서 질문1 답변]에서 지원자의 핵심 가치관이 드러난 문장을 반드시 그대로 인용하며 **'자기소개서에 [인용문장]라고 작성하셨습니다.'**라는 문구로 질문을 즉시 시작하십시오. 이때 직무 세부 사항은 언급하지 말고, 오직 인용된 가치관과 회사의 인재상인 '{company_ideal}'을 연결하여 비전공자로서 새로운 직군(IT)에 임할 때 어떤 기준과 책임감을 가질 것인지 묻는 딱 1개의 단일 질문을 생성하십시오. 모든 질문은 반드시 '~주세요.'로 끝내고 물음표를 절대 사용하지 마십시오."

### [가이드 2] 실시간 동적 지시어 (`question_generator.py`)
면접 진행 중 생성 엔진에서 추가로 부여하는 '최종 명령 계층'입니다. 질문의 톤과 매너를 최종 제어합니다.

```python
# 11번(responsibility) 스테이지 전용 지시어 설정
mode_task_instruction = (
    "자기소개서에서 나타난 지원자의 핵심 가치관(정직, 책임감 등)을 파악하여 인재상과 연결하십시오. "
    "서비스 설계나 코드 같은 기술 내용은 일절 언급하지 말고 오직 인성적인 면모를 80자 이내로 물으십시오."
)

mode_instruction = (
    "이전 답변 요약을 생략하고, '자기소개서에서 ~한 가치관이 인상적이었습니다. 그렇다면...'과 같이 "
    "자연스럽게 대화하십시오. 전반적인 길이를 30% 더 짧게 생성하십시오."
)
```

### [분석 결과] 가이드의 상호작용
*   **인용 강제**: 시나리오 가이드에 의해 자소서 문구 인용이 강제됩니다.
*   **기술 배제**: 동적 지시어에 의해 1~8번 단계의 기술적 키워드가 인성 단계인 11번으로 넘어오는 것을 원천 차단합니다.
*   **간결성 유지**: 80자 이내라는 강력한 제약 조건을 통해 AI가 사족을 붙이지 못하게 제어합니다.
