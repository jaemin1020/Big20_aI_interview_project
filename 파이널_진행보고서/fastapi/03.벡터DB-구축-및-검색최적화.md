# 🗄️ 벡터 DB(pgvector) 이해 및 구축 사례 보고서

---

## 1. 개요

본 보고서는 우리 프로젝트에서 지원자의 이력서 데이터를 효율적으로 검색하기 위해 도입한 **벡터 DB(pgvector)**의 개념과 실제 구현 방식, 그리고 검색 최적화 전략을 기술한다.

---

## 2. 벡터 DB의 개념 및 pgvector 선정 이유ㄴ

### 2.1 벡터 DB란?

텍스트, 이미지 등의 비정형 데이터를 AI 모델(Embedding Model)을 통해 수백~수천 차원의 숫자 배열(Vector)로 변환하고, 이를 저장 및 검색하는 데 최적화된 데이터베이스이다.

### 2.2 pgvector 선정 이유

* **통합성**: PostgreSQL 내에서 관계형 데이터(사용자 정보, 면접 일정)와 벡터 데이터를 하나의 쿼리로 통합 관리할 수 있다.
* **신뢰성**: 일반적인 관계형 DB의 트랜잭션(ACID) 특성을 그대로 유지하며 벡터 검색 기능을 제공한다.
* **인프라 효율성**: 별도의 외부 벡터 DB(Pinecone 등)를 운영할 필요가 없어 시스템 복잡도가 낮아진다.

---

## 3. 현 프로젝트 적용 사례 (tasks/pgvector_store.py)

### 3.1 데이터 저장 프로세스

이력서를 조각(Chunk)으로 나누고 임베딩 모델을 거쳐 숫자로 변환한 뒤, `pgvector` 테이블에 저장한다.

```python
# [데이터 저장 사례]
def store_embeddings(resume_id, embedded_chunks):
    # LangChain의 PGVector 레고 블록 활용
    vector_store = PGVector.from_documents(
        embedding=get_embedder(),
        documents=documents,
        collection_name="resume_all_embeddings",
        connection_string=DATABASE_URL,
        pre_delete_collection=False
    )
```

### 3.2 검색 최적화 (tasks/rag_retrieval.py)

단순한 전체 검색이 아니라, **메타데이터 필터링**을 통해 검색 속도와 정확도를 높였다.

```python
# [메타데이터 필터링 적용 사례]
def retrieve_context(query, resume_id=1, top_k=10, filter_type=None):
    # 1. '현재 면접 중인 지원자(resume_id)'의 데이터만 검색 범위로 한정
    search_filter = {"resume_id": resume_id}
  
    # 2. 특정 카테고리(예: 경력사항만) 검색이 필요한 경우 추가 필터링
    if filter_type:
        search_filter["chunk_type"] = filter_type

    # 3. 필터가 적용된 유사도 검색 수행
    docs_with_scores = vector_store.similarity_search_with_score(
        query, k=top_k, filter=search_filter
    )
```

---

## 4. 종합 평가 및 인사이트

| 항목                | 기존 SQL 검색 (LIKE)                     | 벡터 검색 (Similarity)                     |
| :------------------ | :--------------------------------------- | :----------------------------------------- |
| **검색 방식** | 키워드 중심 (토씨 하나 틀리면 검색 불가) | **의미 중심 (유사한 문맥을 찾아냄)** |
| **성능**      | 텍스트 길이에 따라 급격히 느려짐         | **고속 인덱싱(IVF, HNSW) 가능**      |
| **활용**      | 단순 팩트 체크                           | **RAG 기반 AI 질문 생성의 재료**     |

---

## 5. 결론

우리 프로젝트는 `pgvector`를 도입함으로써 **"이력서에서 'Java 실력'을 묻는 질문을 만들 때, 이력서의 수많은 텍스트 중 관련 있는 경력/자료만 초고속으로 추출"**하여 AI에게 전달할 수 있는 기반을 마련하였다.

---

**[작성 위치]**

* 파일 경로: `C:\big20\Big20_aI_interview_project\파이널_진행보고서\벡터db\03.벡터DB-구축-및-검색최적화.md`
