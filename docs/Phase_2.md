# 🔍 Phase 2: 지능형 면접 RAG 시스템 구축 설계서

> **작성일**: 2026-02-05
> **상태**: 🔄 **구현 진행 중 (설계 고도화 완료)**
> **목적**: 기업 인재상(Ideal)과 이력서 섹션별 데이터를 결합한 단계별 RAG 면접 시스템 구축

---

## 🚀 실행 과정 기록 (Current Progress)

### ✅ **Step 1: PostgreSQL HNSW 인덱스 생성 (완료)**

- **내용**: `resume_chunks.embedding`에 HNSW 기반 코사인 유사도 인덱스 적용.
- **효과**: 수만 개의 질문 및 이력서 조각 중 0.1초 내외로 유사 데이터 검색 가능.

### ✅ **Step 2: 검색 헬퍼 Task 구현 (완료)**

- **내용**: `ai-worker`에 쿼리 임베딩 생성 전용 Celery Task (`generate_query_embedding`) 등록.
- **모델**: KURE-v1 (1024차원) 사용하여 한국어 맥락 이해도 극대화.

### ✅ **Step 3: 기본 벡터 검색 API 구현 (완료)**

- **내용**: `/test/resumes/search` 엔드포인트 구축 완료.
- **현황**: 단순 벡터 검색 작동 확인됨. (이제 이를 **섹션 기반 지능형 검색**으로 업그레이드할 단계)

---

## 🏗️ Phase 2 고도화 설계 (New Strategy)

### 1. 데이터 구조화 전략 (Indexing Strategy)

이력서와 질문 데이터를 단순 텍스트가 아닌 **'의미 단위 라벨'**로 관리하여 검색 정확도를 높입니다.

#### **A. 이력서 구조화 (Resume Chunking)**

- **테이블**: `resume_chunks`
- **추가 칼럼**: `section_type` (Enum)
  - `SKILL_CERT`: 기술 스택(Wireshark, 리눅스 등) + 자격증(정보보안기사 등)
  - `CAREER_PROJECT`: 경력 사항(KISA 인턴 등) + 프로젝트 경험(IDS 구축 등)
  - `COVER_LETTER`: 자기소개서 전반 (지원동기, 성격의 장단점, 포부 등)

#### **B. 질문 은행 구조화 (Question Categorization)**

- **테이블**: `questions`
- **분류(Type)**: `직무지식`, `직무경험(고난도)`, `인성`, `상황(LLM 생성용)`

#### **C. 기업 인재상 연동 (Company Ideal)**

- **테이블**: `companies`
- **핵심 데이터**: `ideal` (인재상 텍스트)
- **역할**: 모든 면접 질문 생성 시 LLM의 **System Prompt**에 주입되는 핵심 가이드라인.

---

### 2. 단계별 RAG 검색 및 생성 프로세스

면접의 흐름에 따라 참조하는 데이터와 질문 생성 전략을 다르게 가져갑니다.

| 면접 단계              | 이력서 소스 (Query) | DB 질문 타겟 (Retrieval) | LLM 생성 전략 (Augmentation)                                           |
| :--------------------- | :------------------ | :----------------------- | :--------------------------------------------------------------------- |
| **0. 준비**      | 지원 회사 ID        | `Companies` (Ideal)    | 기업의 가치관을 면접 컨텍스트로 로드                                   |
| **1. 직무 지식** | `SKILL_CERT`      | `Questions` (직무지식) | **[자격증/기술] + [인재상]**: 기술적 근거와 정직성 검증          |
| **2. 직무 경험** | `CAREER_PROJECT`  | `Questions` (직무경험) | **[경험] + [인재상]**: 실무 성과와 책임감을 고난도 질문으로 검증 |
| **3. 문제 해결** | `CAREER_PROJECT`  | (Direct Generation)      | **[프로젝트 상황] + [Ideal]**: 가상 장애 시나리오 질문 생성      |
| **4. 인성 평가** | `COVER_LETTER`    | `Questions` (인성)     | **[자소서] + [Ideal]**: 인재상과의 부합도 및 잠재 리스크 검증    |

---

## 📝 향후 구현 상세 (Implementation Details)

### **Step 4: DB 스키마 수정 및 라벨링 로직 (Next)**

- `resume_chunks` 테이블에 `section_type` 칼럼 추가.
- `ai-worker`의 파싱 로직을 수정하여 LLM이 이력서를 3가지 섹션으로 분류하도록 업데이트.

### **Step 5: 섹션 기반 검색 API 고도화**

- `backend-core`에서 검색 시 `section_type`을 필터로 사용하는 하이브리드 검색 구현.
- 기업 인재상을 포함한 '지능형 프롬프트 템플릿' 개발.

### **Step 6: 질문 및 모범답안 일괄 임베딩**

- 기존 `questions`와 `answer_bank` 데이터를 벡터화하여 DB에 동기화.

---

## 📊 기대 효과 (Expected Outcome)

- **보안 엔지니어 최승우 지원자(예시)**가 **안랩(인재상: 정직/최고/협력)**에 지원했을 때:
  1. "방화벽 운영" 기술에서 **정직함**을 묻는 기술 질문이 나옵니다.
  2. "IDS 프로젝트" 경험에서 **최고의 성과**를 냈던 고난도 트러블슈팅을 묻습니다.
  3. 전 과정에서 **안랩맨**으로서의 적합성을 자동으로 평가합니다.

---

## ✅ 완료 체크리스트

- [X] PostgreSQL HNSW 인덱스 생성
- [X] 쿼리 임베딩 생성 Task 등록
- [X] 기본 벡터 검색 API 구축
- [ ] **ResumeChunk 테이블 내 라벨(`section_type`) 추가**
- [ ] **LLM 기반 이력서 섹션별 분류 파이프라인 구축**
- [ ] **기업 인재상 주입 프롬프트 엔진 개발**
- [ ] **면접 단계별 하이브리드 검색 API 구현**
