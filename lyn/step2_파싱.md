# 📋 이력서 파싱 완벽 가이드

## 🎯 목표

LlamaCpp 모델로 이력서를 파싱해서 **완벽한 JSON 구조** 생성하기!

특히 **자기소개서 원문 100% 보존** (요약 금지!)

---

## 📦 출력 JSON 구조

```json
{
  "meta": {
    "version": "1.0",
    "parsed_at": "2026-02-08T...",
    "source_file": "resume.pdf"
  },
  
  "profile": {
    "name": "최승우",
    "target_role": "보안엔지니어",
    "target_company": "안랩",
    "contact": {
      "email": "...",
      "phone": "...",
      "address": "..."
    }
  },
  
  "experience": [ ... ],
  "education": [ ... ],
  "projects": [ ... ],
  "awards": [ ... ],
  "certifications": [ ... ],
  "languages": [ ... ],
  
  "narratives": {
    "motivation_and_goals": {
      "question": "[질문1]안랩에 지원한 동기와...",
      "content": "안랩은 대한민국 보안의... (원문 그대로!)",
      "keywords": []
    },
    "project_experience": {
      "question": "[질문2]보안 엔지니어로서...",
      "content": "보안 엔지니어의 경쟁력은... (원문 그대로!)",
      "keywords": []
    },
    "collaboration": {
      "question": "[질문3]공동의 목표를...",
      "content": "구축한 IDS 시스템이... (원문 그대로!)",
      "keywords": []
    }
  }
}
```

---

## 🚀 사용 방법

### 1️⃣ 파일 구조

```
your_project/
├── step1_load_resume.py          # 이력서 로드 (기존 파일)
├── step2_parse_resume_FINAL.py   # 🌟 새 파싱 코드
└── parsed_resume.json            # 출력 결과
```

### 2️⃣ 실행

```bash
python step2_parse_resume_FINAL.py
```

### 3️⃣ 출력 예시

```
================================================================================
🚀 이력서 파싱 시작
================================================================================
📄 이력서 총 길이: 2446자

================================================================================
🚀 [1/3단계] 기본 스펙 정보 추출 중...
================================================================================
✅ 기본 정보 추출 완료
   - 이름: 최승우
   - 목표 직무: 보안엔지니어
   - 경력: 1건
   - 학력: 2건
   - 프로젝트: 1건
   - 자격증: 3건

================================================================================
🚀 [2/3단계] 자기소개서 질문 헤더 찾기...
================================================================================
✅ 추출된 질문 헤더:
   - motivation_header: [질문1]안랩에 지원한 동기와...
   - project_header: [질문2]보안 엔지니어로서...
   - collaboration_header: [질문3]공동의 목표를...

================================================================================
✂️ [3/3단계] 자기소개서 원문 정밀 추출 (요약 방지)...
================================================================================
   ✅ [motivation_and_goals]
      질문: [질문1]안랩에 지원한 동기와 본인이 지향하는...
      답변 길이: 543자
      답변 미리보기: 안랩은 대한민국 보안의 자부심이며...

   ✅ [project_experience]
      질문: [질문2]보안 엔지니어로서 필요한...
      답변 길이: 596자
      답변 미리보기: 보안 엔지니어의 경쟁력은...

   ✅ [collaboration]
      질문: [질문3]공동의 목표를 달성하는...
      답변 길이: 576자
      답변 미리보기: 구축한 IDS 시스템이...

================================================================================
💾 결과 저장 중...
================================================================================
✅ 이력서 파싱 완료! → parsed_resume.json

================================================================================
📊 최종 결과 요약
================================================================================
   - 이름: 최승우
   - 직무: 보안엔지니어
   - 회사: 안랩
   - 경력: 1건
   - 학력: 2건
   - 프로젝트: 1건
   - 자격증: 3건
   - 자기소개서: 3개 문항
   - 총 자기소개서 길이: 1715자
   ✅ 자기소개서 원문 추출 성공!
```

---

## 🔧 핵심 기능

### ✅ 1. 3단계 파싱 프로세스

**[1단계] LLM으로 기본 스펙 추출**

* profile, experience, education, projects, awards, certifications, languages
* LLM이 구조화된 JSON 생성

**[2단계] LLM으로 자기소개서 질문 헤더 찾기**

* "[질문1]", "[질문2]", "[질문3]" 위치 파악
* LLM이 질문 문장 추출

**[3단계] 파이썬으로 원문 정밀 추출**

* LLM 요약 방지! 파이썬이 직접 텍스트 자르기
* 질문과 답변을 함께 추출
* `question` 필드에 질문 원문
* `content` 필드에 답변 원문

### ✅ 2. 자기소개서 원문 100% 보존

```python
# 나쁜 예 (LLM이 요약)
"content": "안랩 지원 동기는 보안 전문가가 되기 위함" ❌

# 좋은 예 (원문 그대로)
"content": "안랩은 대한민국 보안의 자부심이며, 제가 가진 보안 전문가로서의 윤리 의식과 사명감을..." ✅
```

### ✅ 3. question 필드 추가

```json
{
  "question": "[질문1]안랩에 지원한 동기와 본인이 지향하는 보안 전문가로서의 가치관을 설명하고, 급변하는 기술 환경 속에서 안랩의 성장에 기여하기 위한 본인만의 구체적인 역량 개발 계획을 기술해 주십시오.",
  "content": "안랩은 대한민국 보안의..."
}
```

**왜 필요한가?**

* 면접관이 "자소서 1번 질문이 뭐였지?" 할 때 참조
* 질문 유형별 면접 질문 생성
* 질문-답변 일관성 검증

---

## 🎯 활용 예시

### 1. 자소서 기반 면접 질문 생성

```python
import json

data = json.load(open("parsed_resume.json"))

# 지원 동기 답변 가져오기
motivation = data['narratives']['motivation_and_goals']['content']

# LLM에게 전달
print(f"다음 자기소개서를 읽고 심화 질문 3개를 만들어:\n{motivation}")

# 예상 질문:
# - "무결점 탐지율을 유지하겠다는데, False Positive는 어떻게 줄일 건가요?"
# - "3년 내 머신러닝 프로젝트를 주도하겠다는데, 현재 수준은?"
# - "안랩 고유의 위협 분석 시스템에 대해 알고 계신 게 있나요?"
```

### 2. 자소서 vs 경력 교차 검증

```python
# 자소서에서 "KISA 인턴" 언급
collab = data['narratives']['collaboration']['content']

# 경력 정보
kisa_exp = data['experience'][0]

# 검증
if "KISA 인턴" in collab:
    print(f"자소서에 KISA 언급: O")
    print(f"경력란에 KISA 있음: {kisa_exp['organization']}")
    print(f"→ 면접 질문: KISA에서 구체적으로 어떤 업무를 하셨나요?")
```

### 3. 키워드 추출 (나중에)

```python
# 나중에 LLM으로 keywords 배열 채우기
for key, item in data['narratives'].items():
    content = item['content']
    keywords = extract_keywords(content)  # 별도 함수
    item['keywords'] = keywords

# 예시 결과:
# "keywords": ["안랩", "무결점 탐지", "머신러닝", "3년 계획", "KISA"]
```

---

## ⚠️ 문제 해결

### 문제 1: narratives가 비어있음

**증상:**

```json
"narratives": {}
```

**원인:**

* 이력서에 "[질문1]", "[질문2]", "[질문3]" 패턴이 없음
* LLM이 질문 헤더를 찾지 못함

**해결:**

1. 이력서에 "[질문1]" 형태가 있는지 확인
2. 없다면 질문 패턴 수정 필요:
   ```python
   # 코드에서 수정q1 = extract_narrative_with_question(narrative_section, "1.", "2.")
   ```

### 문제 2: 자기소개서가 요약되어 나옴

**증상:**

```json
"content": "지원 동기는 보안 전문가가 되기 위함"  # 너무 짧음
```

**원인:**

* LLM이 답변을 요약함
* 파이썬 추출 로직 실패

**해결:**

* `extract_narrative_with_question` 함수가 제대로 동작하는지 확인
* 로그에서 "답변 길이: XXX자" 확인
* 500자 이상이어야 정상

### 문제 3: JSON 파싱 에러

**증상:**

```
JSONDecodeError: Expecting property name enclosed in double quotes
```

**원인:**

* LLM이 잘못된 JSON 생성

**해결:**

* `json_repair` 라이브러리가 자동으로 수정
* 계속 실패하면 LLM 온도(temperature) 낮추기

---

## 📊 성능 체크리스트

파싱 후 다음을 확인하세요:

* [ ] `profile.name`에 이름이 들어있음
* [ ] `experience` 배열에 경력이 1개 이상
* [ ] `narratives`에 3개 항목 존재
* [ ] 각 narrative의 `content` 길이가 200자 이상
* [ ] 각 narrative의 `question` 필드가 "[질문X]"로 시작
* [ ] JSON 파일이 정상적으로 로드됨

---

## 🎉 성공 기준

✅ **완벽한 파싱:**

```
- 이름: 최승우
- 직무: 보안엔지니어
- 경력: 1건
- 학력: 2건
- 자기소개서: 3개 문항
- 총 자기소개서 길이: 1715자
✅ 자기소개서 원문 추출 성공!
```

---

## 💡 다음 단계

1. **키워드 추출 자동화**
   * 별도 LLM 호출로 `keywords` 배열 채우기
2. **면접 질문 생성기 연동**
   * `narratives`를 입력으로 받아 질문 자동 생성
3. **여러 이력서 일괄 처리**
   * 폴더 내 모든 PDF 자동 파싱
4. **데이터베이스 저장**
   * JSON을 DB에 저장하여 검색 가능하게

---

## 📞 문의

문제가 생기면 다음을 확인하세요:

1. `step1_load_resume.py`가 제대로 동작하는지
2. 이력서에 "[질문1]", "[질문2]", "[질문3]" 패턴이 있는지
3. LLM 모델이 정상 로드되는지
4. `json_repair` 라이브러리가 설치되었는지

Happy Parsing! 🚀
