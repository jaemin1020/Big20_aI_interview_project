# AI 면접 시스템 통합 테스트 및 오류 분석 보고서

**일시:** 2026-02-18
**작성자:** Antigravity (AI Assistant)
**상태:** 조치 완료

---

## 1. 면접 중단 및 답변 제출 실패 결함 (401 Unauthorized)

### [현상]

면접 진행 중(약 10번 질문 부근) 갑자기 "답변 제출에 실패했습니다"라는 메시지와 함께 서버 로그에 `401 Unauthorized` 에러 발생.

### [원인 분석]

- **보안 토큰 만료**: 기존 JWT 인증 토큰의 만료 시간(`ACCESS_TOKEN_EXPIRE_MINUTES`)이 30분으로 설정되어 있었음.
- 면접 준비 및 진행 시간이 30분을 초과할 경우, 백엔드 서버가 유효하지 않은 사용자로 판단하여 모든 요청을 거부함.

### [조치 사항]

- **토큰 만료 시간 연장**: `backend-core/utils/auth_utils.py` 내 설정을 **30분 → 1440분(24시간)**으로 대폭 수정.
- 장시간의 면접 세션에서도 인증이 유지되도록 보장함.

---

## 2. 면접 조기 종료 결함 (2번 질문 후 종료 현상)

### [현상]

실시간 면접 모드에서 1, 2번 질문(공통 템플릿) 이후 다음 질문이 생성되지 않고 면접이 강제 종료됨.

### [원인 분석]

1. **프론트엔드 버튼 레이블 오류**: 초기 질문이 2개만 배정된 상태에서 2번째 질문의 버튼이 [다음 질문]이 아닌 [답변 제출]로 표시되어 사용자가 종료 트리거를 누르게 유도함.
2. **조기 종료 로직**: 질문이 생성 중일 때 프론트엔드에서 기다리지 않고 즉시 `complete` 요청을 보내버림.
3. **5개 답변 로그의 오해**: AI 질문(2)+사용자 답변(2)+종료 인사(1)가 합쳐져 5개로 표시된 것이며, 실제로는 질문이 끊긴 것임.

### [조치 사항]

- **UI 레이블 수정**: `InterviewPage.jsx`의 버튼명을 `답변 완료 (다음 단계)`로 변경하여 혼선 방지.
- **종료 판정 로직 강화**: `App.jsx`에서 서버가 명시적으로 `COMPLETED` 상태를 반환하기 전까지는 절대 자동으로 종료하지 않고 질문 생성을 폴링(Polling)하도록 수정.

---

## 3. AI 질문 생성 문맥 및 페르소나 미흡

### [현상]

- 지원자의 **포부(할 것이다)**를 **경험(했다)**으로 오해하여 잘못된 질문을 던짐.
- `[활동]`, `[자기소개서]` 등 데이터 태그(괄호)가 질문에 그대로 노출되어 기계적인 느낌을 줌.

### [원인 분석]

- **LLM 프롬프트 한계**: 'Fact-checking' 지침이 부족하여 자기소개서의 미래 계획을 과거 프로젝트 경험으로 혼동함.
- **데이터 바인딩 표기**: RAG(검색 증강 생성) 과정에서 사용된 내부 분류 태그가 정제되지 않고 LLM에게 전달됨.

### [조치 사항]

- **프롬프트 고도화**: `question_generator.py`의 `PROMPT_TEMPLATE`에 "경험(Fact)과 포부(Aspiration)를 엄격히 구분할 것"과 "자연스러운 문장 권장" 규칙을 추가.
- **데이터 정제**: 내부 메타태그(`[활동]`, `[질문1]`)를 제거하고 "경험 및 활동 기록:", "자기소개서 1번 내용:"과 같이 자연스러운 문구로 컨텍스트 레이블 변경.
- **출처 명시 강화**: 질문 시작 시 실제 데이터의 출처를 정확히 밝히도록 개선.

---

## 4. 리포트 생성 실패 및 분석 결과 미흡 결함

### [현상]

면접 종료 후 결과 리포트를 확인했을 때, AI의 상세 분석이 누락되거나 기본값(70점 등)으로만 표시되는 현상 발생. (면접 ID 694 등)

### [원인 분석]

- **Context Window 초과**: 면접 대화량이 많아질 경우(기록 30개 내외), AI 모델에게 전달되는 토큰 수가 제한치(4,096 토큰)를 초과함.
- **LLM 중단**: 메모리 초과로 인해 LLM이 결과 생성을 중단하거나 잘못된 JSON 형식을 출력하여 파싱에 실패함.
- **고정 폴백 값**: 분석 실패 시 무조건 70점과 기본 텍스트를 할당하도록 로직이 단순하게 구성되어 있었음.

### [조치 사항]

- **메모리(N_CTX) 확장**: `exaone_llm.py` 엔진 설정에서 Context Window 크기를 **4,096 → 8,192**로 상향 조정.
- **적극적 메모리 회수**: 리포트 생성(LLM 부하가 큰 작업) 직전에 `torch.cuda.empty_cache()` 및 `gc.collect()`를 호출하여 GPU 메모리 Stall(멈춤) 현상 방지.
- **대화 내용 자동 압축**: `evaluator.py`에 대화가 너무 길 경우(12,000자 초과) 핵심 앞/뒷부분만 남기고 중간을 생략하는 Truncation 로직 적용.
- **실시간 분석 현황 노출 (Fallback)**: 리포트가 아직 생성 중일 때 "미상"으로 표시되는 대신, "AI가 분석 중입니다"라는 안내 문구와 함께 지원 직무/회사명을 선제적으로 노출하도록 백엔드 API 개선.
- **점수 산정 로직 고도화**: 전체 분석 요약이 실패하더라도, 면접 중 실시간 진행된 **개별 질문별 점수들의 평균**을 계산하여 실제 답변 품질이 반영되도록 보정 로직 개선.

---

## 5. 시나리오 및 파일 관리 최적화

### [조치 사항]

- **파일명 표준화**: `interview-scenario-transition.py`를 Python 표준인 `interview_scenario_transition.py`로 변경하여 임포트 오류 예방.
- **시나리오 동기화**: `ai-worker`와 `backend-core` 양쪽의 시나리오 파일을 최신화하여 실시간 면접 로직 일치시킴.

---

## 6. 리포트 데이터 누락 및 "미상" 표시 결함

### [현상]

- 리포트 화면에서 지원 회사/직무가 "미상"으로 표시됨.
- 기술 이해도 등 상세 분석 내용이 AI 분석 본문 대신 시스템 기본 문구(Placeholder)로 표시됨.

### [원인 분석]

1. **스키마 불일치**: `EvaluationReportResponse` 모델에 상세 피드백 필드(`technical_feedback` 등)가 정의되어 있지 않아, 백엔드에서 데이터를 넣어주어도 FastAPI의 응답 필터링 과정에서 삭제됨.
2. **폴백 로직 부재**: 이력서나 인터뷰 정보에서 직무/회사명을 가져오지 못할 경우에 대한 예외 처리가 부족하여 초기값("미상")이 그대로 노출됨.

### [조치 사항]

- **응답 스택(Schema) 보강**: `db_models.py`의 `EvaluationReportResponse`에 모든 상세 피드백 필드 및 강점/보완점 필드를 명시적으로 추가.
- **데이터 바인딩 강화**: `interviews.py`의 리포트 조회 로직에서 이력서(`structured_data`), 인터뷰 정보, 회사 정보를 순차적으로 탐색하여 "미상" 대신 최대한 유효한 정보를 매핑하도록 수정.
- **빈 값 처리**: AI 분석 결과가 비어 있을 경우, 사용자에게 불안감을 주지 않도록 "분석 결과가 생성 중입니다" 또는 "기본 분석 결과"를 폴백으로 제공함.

---

## 7. AI 질문 품질 및 불필요한 레이블 노출 결함

### [현상]

- 생성된 질문에 `답변:`, `요약:`, `추가적으로 궁금한 점:` 등 시스템용 레이블이 포함됨.
- `(이전 답변에서 언급한)`과 같은 불필요한 괄호나 특수문자(`~`, `[]`)가 노출되어 부자연스러움.
- 꼬리 질문 시 "말씀해 주셨는데," 와 같은 문구가 문맥 없이 사용됨.

### [원인 분석]

1. **프롬프트 예시 오염**: 기존 프롬프트 내 규칙 설정 시 예시로 든 문자열(`~라고 말씀해 주셨는데,`)을 LLM이 그대로 모방함.
2. **단일 생성 한계**: LLM이 질문 내용 생성과 출력 형식 정제를 동시에 수행하면서 형식을 놓치는 경우가 발생함.

### [조치 사항]

- **2단계 생성 구조(Self-Correction) 도입**:
  - **1단계(Generation)**: 질문 본문 생성.
  - **2단계(Refinement)**: 생성된 질문을 다시 한 번 LLM에게 보내 불필요한 레이블, 특수문자, 사족을 제거하도록 정제 요청.
- **프롬프트 절대 규칙 강화**:
  - "말머리 금지", "특수문자 금지", "괄호 설명 금지" 규칙을 최상위 지침으로 격상.
  - 자연스러운 시작 문구(예: "자기소개서에서 ~라고 언급하신 것을 보았습니다") 권장 지침 추가.
- **정규식(Regex) 필터링**: LLM 응답 후에도 코드 레벨에서 특수 기호(`*`, `_`, `~`, `[]`, `()`)를 한 번 더 강제로 제거하여 안정성 확보.

---

**[향후 모니터링 사항]**

- 직무 지식(Skill) 단계에서의 질문 난이도가 적정 수준(Easy)으로 유지되는지 확인.
- 2단계 생성 도입 후 질문 생성 소요 시간(Latency) 체크 (현재 약 20~30초 예상).
